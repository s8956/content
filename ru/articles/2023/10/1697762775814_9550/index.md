---
# -------------------------------------------------------------------------------------------------------------------- #
# General settings.
# -------------------------------------------------------------------------------------------------------------------- #

title: 'Дефрагментация в ОС Windows'
description: ''
images:
  - 'https://images.unsplash.com/photo-1591913139332-f8172ef511da'
categories:
  - 'windows'
  - 'terminal'
tags:
  - 'hdd'
  - 'ssd'
  - 'powershell'
  - 'cmd'
  - 'defrag'
authors:
  - 'KaiKimera'
sources:
  - 'https://learn.microsoft.com/en-us/powershell/module/storage/optimize-volume'
  - 'https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/defrag'
license: 'CC-BY-SA-4.0'
complexity: '0'
toc: 1
comments: 1

# -------------------------------------------------------------------------------------------------------------------- #
# Date settings.
# -------------------------------------------------------------------------------------------------------------------- #

date: '2023-10-20T03:46:16+03:00'
publishDate: '2023-10-20T03:46:16+03:00'
expiryDate: ''
lastMod: '2023-10-20T03:46:16+03:00'

# -------------------------------------------------------------------------------------------------------------------- #
# Meta settings.
# -------------------------------------------------------------------------------------------------------------------- #

type: 'articles'
hash: 'eb39e3f7b19443d40bad01edf9fdac478df57c52'
uuid: 'eb39e3f7-b194-53d4-8bad-01edf9fdac47'
slug: 'eb39e3f7-b194-53d4-8bad-01edf9fdac47'

draft: 0
---

При работе с оборудованием, мне приходится сталкиваться с довольно старыми устройствами, их их работу нужно как-нибудь оптимизировать. Одним из вариантов оптимизации является дефрагментация {{< tag "HDD" >}}.

<!--more-->

## PowerShell

Командлет по дефрагментации для {{< tag "PowerShell" >}} называется `Optimize-Volume` и может принимать следующие параметры: 

- `-Analyze` - выполнение анализа указанного тома.
- `-Defrag` - выполнение дефрагментации указанного тома.
- `-DriveLetter` - буква тома.
- `-NormalPriority` - выполнение процесса с нормальным приоритетом (по умолчанию приоритет пониженный).
- `-ReTrim` - выполнение TRIM-операции для {{< tag "SSD" >}}.

Это наиболее востребованные параметры. Остальные параметры можно посмотреть в [официальной документации](https://learn.microsoft.com/en-us/powershell/module/storage/optimize-volume).

{{< alert "tip" >}}
Для всех команд можно добавить параметр `-Verbose`, который выводит подробную информацию о происходящем процессе.
{{< /alert >}}

### Анализ тома

```powershell
Optimize-Volume -DriveLetter C -Analyze
```

Где:
- `-DriveLetter C` - буква тома (диск C:).
- `-Analyze` - анализ.

### Дефрагментация

```powershell
Optimize-Volume -DriveLetter C -Defrag
```

Где:
- `-DriveLetter C` - буква тома (диск C:).
- `-Defrag` - дефрагментация.


### TRIM-операция для SSD

```powershell
Optimize-Volume -DriveLetter C -ReTrim
```

Где:
- `-DriveLetter C` - буква тома (диск C:).
- `-ReTrim` - на дисках SSD запускает TRIM-операцию.

## CMD Defrag

Утилита `defrag.exe` выполняет анализ и оптимизацию томов через командную строку. Утилита может принимать следующие параметры:

- Тома:
  - `/c` - выполнение операции на всех томах.
  - `/e` - выполнение операции на всех томах, кроме указанных.
- Операции:
  - `/a` - анализ указанных томов.
  - `/d` - выполнение традиционной дефрагментации (по умолчанию). На многоуровневом томе традиционная дефрагментация выполняется только на уровне ёмкости.
  - `/l` - выполнение TRIM-операции для SSD.
  - `/o` - выполнение правильной оптимизации для каждого типа носителя.
  - `/u` - отображение хода операции.

{{< alert "tip" >}}
Для всех команд можно добавить параметр `/v`, который выводит подробную информацию о происходящем процессе.
{{< /alert >}}

### Анализ тома

Анализ тома, с отображением хода выполнения и выводом результатов в подробном формате:

```cmd
defrag c: /u /a
```

Где:
- `c:` - буква тома (диск `C:`).
- `/u` - отображение хода выполнения операции.
- `/a` - анализ.

### Параллельная дефрагментация

Параллельная дефрагментация томов `C:` и `D:` в фоновом режиме:

```cmd
defrag c: d: /m
```

Где:
- `c:` - буква тома (диск `C:`).
- `d:` - буква тома (диск `D:`).
- `/m` - выполнение операции с каждым томом параллельно в фоновом режиме.

### Дефрагментация всех томах

Выполнить дефрагментацию на всех локальных томах с нормальным приоритетом:

```cmd
defrag /u /c /h
```

Где:
- `/u` - отображение хода выполнения операции.
- `/c` - выполнение операции на всех томах.
- `/h` - выполнение операции с нормальным приоритетом (по умолчанию приоритет пониженный).

### TRIM-операция для SSD

```cmd
defrag /u /c /l
```

Где:
- `/u` - отображение хода выполнения операции.
- `/c` - выполнение операции на всех томах.
- `/l` или `/retrim` - на дисках SSD запускает TRIM-операцию.
