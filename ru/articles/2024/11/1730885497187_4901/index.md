---
# -------------------------------------------------------------------------------------------------------------------- #
# GENERAL
# -------------------------------------------------------------------------------------------------------------------- #

title: 'Массовое добавление IP-адресов в Windows Firewall'
description: ''
images:
  - 'https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a'
categories:
  - 'scripts'
  - 'windows'
  - 'terminal'
  - 'security'
tags:
  - 'powershell'
  - 'firewall'
authors:
  - 'KaiKimera'
sources:
  - 'https://www.gregsitservices.com/blog/2016/02/blocking-unwanted-countries-with-windows-firewall/'
license: 'CC-BY-SA-4.0'
complexity: '0'
toc: 1
comments: 1

# -------------------------------------------------------------------------------------------------------------------- #
# DATE
# -------------------------------------------------------------------------------------------------------------------- #

date: '2024-11-06T12:31:39+03:00'
publishDate: '2024-11-06T12:31:39+03:00'
lastMod: '2024-11-06T12:31:39+03:00'

# -------------------------------------------------------------------------------------------------------------------- #
# META
# -------------------------------------------------------------------------------------------------------------------- #

type: 'articles'
hash: 'e756e17af8066c8ad95d92f13b436bbcbd8f9bc1'
uuid: 'e756e17a-f806-5c8a-995d-92f13b436bbc'
slug: 'e756e17a-f806-5c8a-995d-92f13b436bbc'

draft: 1
---



<!--more-->

## Скрипт

Скрипт массового разрешения/запрещения IP-адресов из файла.

### Установка

- Запустить скрипт с необходимыми параметрами.

### Приложение

{{< file "app.firewall.ip.ps1" "pwsh" >}}

#### Параметры

- `File` - путь к файлу с IP-адресами.
- `RuleName` - общее название правил. По умолчанию: `AUTO.RULE #NNNN`.
- `ProfileType` - тип профиля сети:
  - `public` - публичный.
  - `private` - приватный.
  - `domain` - домен.
  - `any` - любой.
- `InterfaceType` - тип интерфейса:
  - `wireless` - беспроводной.
  - `lan` - проводной.
  - `ras` - Remote Access Service.
  - `any` - любой.
- `Action` - действие:
  - `allow` - разрешить.
  - `block` - блокировать.
  - `bypass` - пропустить.
- `Description` - описание правила.
- `RuleIn` - тип создаваемого правила: правило для входящих подключений.
- `RuleOut` - тип создаваемого правила: правило для исходящих подключений.
- `DeleteOnly` - удалить все правила с именем из скрипта.

#### Синтаксис

- Создать правила для входящих подключений с IP-адресами из файла `ip.db.txt` с действием **запретить**:

```powershell
.\app.firewall.ip.ps1 -File 'ip.db.txt' -RuleIn
```

- Создать правила для входящих подключений с IP-адресами из файла `ip.db.txt` с действием **запретить** для профилей сети "публичный" и "приватный":

```powershell
.\app.firewall.ip.ps1 -File 'ip.db.txt' -RuleIn -ProfileType public,private
```

- Создать правила для входящих подключений с IP-адресами из файла `ip.db.txt` с действием **запретить** для типов интерфейсов "беспроводной" и "проводной":

```powershell
.\app.firewall.ip.ps1 -File 'ip.db.txt' -RuleIn -InterfaceType wireless,lan
```

- Удалить ВСЕ правила с именем `AUTO.RULE #NNNN`:

```powershell
.\app.firewall.ip.ps1 -DeleteOnly
```

- Удалить ВСЕ правила с именем `IpToBlock #NNNN`:

```powershell
.\app.firewall.ip.ps1 -RuleName 'IpToBlock' -DeleteOnly
```

## Предупреждение

Предупреждение от автора оригинального скрипта:

> Тестирование показало задержку в 2-5 секунд для начального соединения, когда в исходящих правилах более 5000 IP-адресов (после установки соединения, задержки нет). Подобное поведение не частое. Кроме того, при 5000+ подсетей в правилах, появляется задержка при открытии оснастки брандмауэра Windows, а при 9000+ подсетей оснастка брандмауэра иногда вообще не открывается. Такое поведение тоже не частое.
